cluster with custom pg_hba:
  1: |
    parameters: null
    pg_hba:
      - host replication postgres all scram-sha-256
cluster with custom pgparams:
  1: |
    parameters:
      TimeZone: Europe/Paris
      work_mem: 512MB
    pg_hba: null
cluster with enabled backup and recovery:
  1: |
    backup:
      barmanObjectStore:
        destinationPath: s3://backups/
        endpointURL: http://minio:9000
        s3Credentials:
          accessKeyId:
            key: ACCESS_KEY_ID
            name: minio
          region:
            key: DEFAULT_REGION
            name: minio
          secretAccessKey:
            key: ACCESS_SECRET_KEY
            name: minio
      retentionPolicy: 30d
    bootstrap:
      recovery:
        recoveryTarget:
          targetTime: 2020-11-26 15:22:00.00000+00
        source: recovery-cluster
    externalClusters:
      - barmanObjectStore:
          destinationPath: s3://backups/
          endpointURL: http://minio:9000
          s3Credentials:
            accessKeyId:
              key: ACCESS_KEY_ID
              name: minio
            secretAccessKey:
              key: ACCESS_SECRET_KEY
              name: minio
          serverName: my-cluster-to-restore
        name: recovery-cluster
    imageName: ghcr.io/cloudnative-pg/postgis:15
    imagePullPolicy: IfNotPresent
    instances: 1
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      enablePodMonitor: false
    postgresql:
      parameters: null
      pg_hba: null
    storage:
      size: 8Gi
cluster with monitoring:
  1: |
    apiVersion: postgresql.cnpg.io/v1
    kind: Pooler
    metadata:
      labels:
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: cnpg-cluster
        app.kubernetes.io/version: "15"
        cnpg.io/poolerName: RELEASE-NAME-cnpg-cluster-rw
        helm.sh/chart: cnpg-cluster-1.11.5
      name: RELEASE-NAME-cnpg-cluster-rw
    spec:
      cluster:
        name: RELEASE-NAME-cnpg-cluster
      instances: 3
  2: |
    apiVersion: monitoring.coreos.com/v1
    kind: PodMonitor
    metadata:
      name: RELEASE-NAME-cnpg-cluster-rw
    spec:
      podMetricsEndpoints:
        - port: metrics
      selector:
        matchLabels:
          cnpg.io/poolerName: RELEASE-NAME-cnpg-cluster-rw
cluster with pg_basebackup:
  1: |
    - connectionParameters:
        dbname: app
        host: some-host-to-replicate-from
        user: postgres
      name: source-cluster
      password:
        key: password
        name: source-secret-for-source-replication
  2: |
    pg_basebackup:
      source: source-cluster
cluster with recovery enabled:
  1: |
    bootstrap:
      recovery:
        recoveryTarget:
          targetTime: 2020-11-26 15:22:00.00000+00
        source: recovery-cluster
    externalClusters:
      - barmanObjectStore:
          destinationPath: s3://backups/
          endpointURL: http://minio:9000
          s3Credentials:
            accessKeyId:
              key: ACCESS_KEY_ID
              name: minio
            secretAccessKey:
              key: ACCESS_SECRET_KEY
              name: minio
          serverName: my-cluster-to-restore
        name: recovery-cluster
    imageName: ghcr.io/cloudnative-pg/postgis:15
    imagePullPolicy: IfNotPresent
    instances: 1
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      enablePodMonitor: false
    postgresql:
      parameters: null
      pg_hba: null
    storage:
      size: 8Gi
cluster with replication:
  1: |
    - connectionParameters:
        dbname: app
        host: some-host-to-replicate-from
        user: postgres
      name: source-cluster
      password:
        key: password
        name: source-secret-for-source-replication
  2: |
    pg_basebackup:
      source: source-cluster
  3: |
    enabled: true
    source: source-cluster
cluster with scheduled backup enabled:
  1: |
    backup:
      barmanObjectStore:
        destinationPath: s3://backups/
        endpointURL: http://minio:9000
        s3Credentials:
          accessKeyId:
            key: ACCESS_KEY_ID
            name: minio
          region:
            key: DEFAULT_REGION
            name: minio
          secretAccessKey:
            key: ACCESS_SECRET_KEY
            name: minio
      retentionPolicy: 30d
    bootstrap:
      initdb:
        database: app
        owner: app
        postInitTemplateSQL: null
    externalClusters: null
    imageName: ghcr.io/cloudnative-pg/postgis:15
    imagePullPolicy: IfNotPresent
    instances: 1
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      enablePodMonitor: false
    postgresql:
      parameters: null
      pg_hba: null
    storage:
      size: 8Gi
