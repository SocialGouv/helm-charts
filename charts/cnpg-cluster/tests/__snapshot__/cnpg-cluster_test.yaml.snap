cluster with custom pgparams:
  1: |
    parameters:
      timezone: Europe/Paris
      work_mem: 512MB
cluster with enabled backup and recovery:
  1: |
    concurrencyPolicy: Forbid
    jobTemplate:
      spec:
        backoffLimit: 0
        template:
          metadata:
            labels:
              app: cnpg-backup-s3-client
            name: backup-cron
          spec:
            containers:
              - env:
                  - name: AWS_ACCESS_KEY_ID
                    valueFrom:
                      secretKeyRef:
                        key: bucket_access_key
                        name: minio
                  - name: AWS_SECRET_ACCESS_KEY
                    valueFrom:
                      secretKeyRef:
                        key: bucket_secret_key
                        name: minio
                  - name: AWS_DEFAULT_REGION
                    valueFrom:
                      secretKeyRef:
                        key: bucket_region
                        name: minio
                  - name: AWS_ENDPOINT_URL
                    value: http://minio:9000
                  - name: DESTINATION_PATH
                    value: s3://backups/dumps
                envFrom:
                  - secretRef:
                      name: pg-hasura-app
                image: ghcr.io/socialgouv/docker/s3-client:1
                imagePullPolicy: IfNotPresent
                name: s3-client
                securityContext:
                  allowPrivilegeEscalation: false
            restartPolicy: Never
            securityContext:
              fsGroup: 1001
              runAsGroup: 1001
              runAsUser: 1001
    schedule: 4 5 6 * * 0
  2: |
    backup:
      barmanObjectStore:
        destinationPath: s3://backups/
        endpointURL: http://minio:9000
        s3Credentials:
          accessKeyId:
            key: ACCESS_KEY_ID
            name: minio
          region:
            key: DEFAULT_REGION
            name: minio
          secretAccessKey:
            key: ACCESS_SECRET_KEY
            name: minio
      retentionPolicy: 30d
    bootstrap:
      recovery:
        recoveryTarget:
          targetTime: 2020-11-26 15:22:00.00000+00
        source: recovery-cluster
    externalClusters:
      - barmanObjectStore:
          destinationPath: s3://backups/
          endpointURL: http://minio:9000
          s3Credentials:
            accessKeyId:
              key: ACCESS_KEY_ID
              name: minio
            secretAccessKey:
              key: ACCESS_SECRET_KEY
              name: minio
          serverName: my-cluster-to-restore
        name: recovery-cluster
    imageName: ghcr.io/cloudnative-pg/postgis:15
    imagePullPolicy: IfNotPresent
    instances: 1
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      enablePodMonitor: false
    postgresql:
      parameters: null
    storage:
      size: 8Gi
  3: |
    backupOwnerReference: self
    cluster:
      name: RELEASE-NAME-cnpg-cluster
    schedule: 1 2 3 * * 0
cluster with recovery enabled:
  1: |
    bootstrap:
      recovery:
        recoveryTarget:
          targetTime: 2020-11-26 15:22:00.00000+00
        source: recovery-cluster
    externalClusters:
      - barmanObjectStore:
          destinationPath: s3://backups/
          endpointURL: http://minio:9000
          s3Credentials:
            accessKeyId:
              key: ACCESS_KEY_ID
              name: minio
            secretAccessKey:
              key: ACCESS_SECRET_KEY
              name: minio
          serverName: my-cluster-to-restore
        name: recovery-cluster
    imageName: ghcr.io/cloudnative-pg/postgis:15
    imagePullPolicy: IfNotPresent
    instances: 1
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      enablePodMonitor: false
    postgresql:
      parameters: null
    storage:
      size: 8Gi
cluster with scheduled backup enabled:
  1: |
    backup:
      barmanObjectStore:
        destinationPath: s3://backups/
        endpointURL: http://minio:9000
        s3Credentials:
          accessKeyId:
            key: ACCESS_KEY_ID
            name: minio
          region:
            key: DEFAULT_REGION
            name: minio
          secretAccessKey:
            key: ACCESS_SECRET_KEY
            name: minio
      retentionPolicy: 30d
    bootstrap:
      initdb:
        database: app
        owner: app
        postInitTemplateSQL: null
    imageName: ghcr.io/cloudnative-pg/postgis:15
    imagePullPolicy: IfNotPresent
    instances: 1
    maxSyncReplicas: 0
    minSyncReplicas: 0
    monitoring:
      enablePodMonitor: false
    postgresql:
      parameters: null
    storage:
      size: 8Gi
